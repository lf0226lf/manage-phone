<!DOCTYPE html>
<html lang="ch">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0,viewport-fit=cover">
	<title>首页</title>
	<link rel="stylesheet" href="css/weui.css">
	<link rel="stylesheet" href="css/common.css">
	<link rel="stylesheet" href="//at.alicdn.com/t/font_1850030_8mjq6fkswqc.css">
	<link rel="stylesheet" href="css/manage.css">
</head>

<body ontouchstart>
	<div class="container" id="container">
		<div class="page home js_show">
			<div class="page__bd">
				<div class="weui-cells__title">基本信息</div>
				<div class="weui-cells">
					<div class="weui-cell ">
						<div class="weui-cell__bd">
							<p>姓名</p>
						</div>
						<div class="weui-cell__ft" id="creater"></div>
					</div>
					<div class="weui-cell ">
						<div class="weui-cell__bd">
							<p>发起日期</p>
						</div>
						<div class="weui-cell__ft" id="beginTime"></div>
					</div>
					<div class="weui-cell ">
						<div class="weui-cell__bd">
							<p>日报时间</p>
						</div>
						<div class="weui-cell__ft" id="createTime"></div>
					</div>
				</div>
				<div class="weui-panel weui-panel_access">
					<div class="weui-panel__hd">
						<span>工作内容 </span>
					</div>
					<div class="weui-panel__bd">
						<a class="weui-media-box weui-media-box_appmsg" onclick="showWork();">
							<div class="weui-media-box__bd">
								<h4 class="weui-media-box__title"><span id="projectName"></span> <small><span id="dailyTime"></span>人/日</small></h4>
								<p class="weui-media-box__desc" id="content"></p>
								<!--
                                <ul class="weui-media-box__info">
                                    <li class="weui-media-box__info__meta">刘飞</li>
                                    <li class="weui-media-box__info__meta">2020-05-12 17:17:06</li>
                                    <li class="weui-media-box__info__meta weui-media-box__info__meta_extra">0.5人/日</li>
                                </ul>
-->
							</div>
						</a>
					</div>
				</div>
				<!--
                <div class="weui-cells__title">审批流程</div>
                <div class="weui-cells">
                    <div class="weui-cell ">
                        <div class="weui-cell__bd">
                            <p>审批人</p>
                        </div>
                        <div class="weui-cell__ft">王万金</div>
                    </div>
                    <div class="weui-cell ">
                        <div class="weui-cell__bd">
                            <p>审批人</p>
                        </div>
                        <div class="weui-cell__ft">王万金</div>
                    </div>
                </div>
-->
				<div class="weui-btn-area">
					<div class="weui-flex">
						<div class="weui-flex__item">
							<div class="p-x-sm">
								<a href="javascript:" class="weui-btn weui-btn_default" style="width: auto;" id="refuse">驳 回</a>
							</div>
						</div>
						<div class="weui-flex__item">
							<div class="p-x-sm">
								<a href="javascript:" class="weui-btn weui-btn_primary" style="width: auto;" id="pass">通 过</a>
							</div>
						</div>
					</div>
					<!--
					<div class="weui-flex" style="justify-content: center;">
						<div>
							<a href="javascript:" class="weui-btn weui-btn_default">返回</a>
						</div>
					</div>
-->
				</div>
			</div>
			<div class="page__ft">
			</div>
		</div>
	</div>
	<div id="showWorkMask" class="weui-mask" style="display: none;">
		<div class="page home js_show">
			<div class="page__bd">
				<div class="weui-cells__title">工作内容详情</div>
				<div class="weui-cells">
					<div class="weui-cell ">
						<div class="weui-cell__bd">
							<p>日报类型</p>
						</div>
						<div class="weui-cell__ft" id="alertType"></div>
					</div>
					<div class="weui-cell ">
						<div class="weui-cell__bd">
							<p>任务关联</p>
						</div>
						<div class="weui-cell__ft" id="alertProjectName"></div>
					</div>
					<div class="weui-cell ">
						<div class="weui-cell__bd">
							<p>工时</p>
						</div>
						<div class="weui-cell__ft"><span id="alertTime"></span> 人/日</div>
					</div>
					<div class="weui-cell ">
						<div class="weui-cell__bd" style="width: 88px;flex: none;">
							<p>日报内容</p>
						</div>
						<div class="weui-cell__ft" style="flex: 1;" id="alertContent"></div>
					</div>
				</div>
				<div class="weui-btn-area">
					<a href="javascript:" class="weui-btn weui-btn_default" onclick="hideMask();">返回</a>
				</div>
			</div>
			<div class="page__ft">
			</div>
		</div>
	</div>
	<div id="dialogs">
		<div class="js_dialog" id="passDialog" style="display: none;">
			<div class="weui-mask"></div>
			<div class="weui-dialog">
				<div class="weui-dialog__hd"><strong class="weui-dialog__title">提示</strong></div>
				<div class="weui-dialog__bd">确定审批通过吗？</div>
				<div class="weui-dialog__ft">
					<a href="javascript:" class="weui-dialog__btn weui-dialog__btn_default">返回</a>
					<a href="javascript:" class="weui-dialog__btn weui-dialog__btn_primary" onclick="confirmPass();">确定</a>
				</div>
			</div>
		</div>
		<div class="js_dialog" id="refuseDialog" style="display: none;">
			<div class="weui-mask"></div>
			<div class="weui-dialog">
				<div class="weui-dialog__hd"><strong class="weui-dialog__title">提示</strong></div>
				<div class="weui-dialog__bd">确定审批驳回吗？</div>
				<div class="weui-dialog__ft">
					<a href="javascript:" class="weui-dialog__btn weui-dialog__btn_default">返回</a>
					<a href="javascript:" class="weui-dialog__btn weui-dialog__btn_primary" onclick="confirmRefuse();">确定</a>
				</div>
			</div>
		</div>
	</div>
	<!--
	<div id="toast" style="display: none;">
		<div class="weui-mask_transparent"></div>
		<div class="weui-toast">
			<i class="weui-icon-success-no-circle weui-icon_toast"></i>
			<p class="weui-toast__content">已完成</p>
		</div>
	</div>
-->
</body></html>


<script src="js/jQuery-2.2.0.min.js"></script>
<script src="js/weui.min.js"></script>
<script src="js/cookie.js"></script>
<script src="js/common.js"></script>
<script src="js/util.js"></script>
<script>
	var getId = GetRequest();
	$.ajax({
		url: apiUrl + 'toHandleDaily',
		type: 'GET',
		data: {
			taskId: getId.id
		},
		success: function(result) {
			console.log(result);
			$('#creater').text(result.resultData.creater);
			$('#beginTime').text(result.resultData.beginTime);
			$('#createTime').text(result.resultData.createTime);
			var type = result.resultData.type;
			var typeName = {
				"0": "商机",
				"1": "项目",
				"2": "其他",
				"3": "行政",
				"4": "企管"
			}
			if (type == '0' || type == '1') {
				$('#projectName').text(result.resultData.projectName);
			} else {
				$('#projectName').text(typeName[result.resultData.type]);
			};
			$('#dailyTime').text(result.resultData.dailyTime);
			$('#content').text(result.resultData.content);
		},
		error: function(XMLHttpRequest, textStatus, errorThrown) {
			console.log(XMLHttpRequest.readyState + XMLHttpRequest.status + XMLHttpRequest.responseText);
		}
	});
	function showWork(){
		$('#showWorkMask').show();
		$.ajax({
			url: apiUrl + 'toHandleDaily',
			type: 'GET',
			data: {
				taskId: getId.id
			},
			success: function(result) {
				console.log(result);
				var typeName = {
					"0": "商机",
					"1": "项目",
					"2": "其他",
					"3": "行政",
					"4": "企管"
				}
				$('#alertType').text(typeName[result.resultData.type]);
				$('#alertProjectName').text(result.resultData.projectName);
				$('#alertTime').text(result.resultData.dailyTime);
				$('#alertContent').text(result.resultData.content);
			},
			error: function(XMLHttpRequest, textStatus, errorThrown) {
				console.log(XMLHttpRequest.readyState + XMLHttpRequest.status + XMLHttpRequest.responseText);
			}
		});
	}
	function hideMask(){
		$('#showWorkMask').hide();
	}
	$('#pass').on('click', function() {
		$('#passDialog').fadeIn(200);
	});
	$('#refuse').on('click', function() {
		$('#refuseDialog').fadeIn(200);
	});
	$('#dialogs').on('click', '.weui-dialog__btn', function() {
		$(this).parents('.js_dialog').fadeOut(200);
	});
	
	function confirmPass() {
		$.ajax({
			url: apiUrl + 'handleDaily',
			type: 'POST',
			data: {
				taskId: getId.id,
				handleStatus: '1'
			},
			success: function(result) {
				console.log(result);
				
			},
			error: function(XMLHttpRequest, textStatus, errorThrown) {
				console.log(XMLHttpRequest.readyState + XMLHttpRequest.status + XMLHttpRequest.responseText);
			}
		});
		window.location.href="/home.html"; 
	}

	function confirmRefuse() {
		$.ajax({
			url: apiUrl + 'handleDaily',
			type: 'POST',
			data: {
				taskId: getId.id,
				handleStatus: '2'
			},
			success: function(result) {
				console.log(result);
			},
			error: function(XMLHttpRequest, textStatus, errorThrown) {
				console.log(XMLHttpRequest.readyState + XMLHttpRequest.status + XMLHttpRequest.responseText);
			}
		});
		window.location.href="/home.html"; 
	}

</script>
